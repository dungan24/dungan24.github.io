---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - assets/css/custom.css
  - assets/css/custom/chart-cards.css
  - assets/css/custom/home-market-overview.css
autonomous: true
requirements:
  - FOUN-04
  - FOUN-05
  - FOUN-06
  - FOUN-07

must_haves:
  truths:
    - "custom.css :root 블록이 chart-cards.css와 home-market-overview.css의 --mp-* 변수를 모두 선언한다"
    - "chart-cards.css와 home-market-overview.css에 :root {} 변수 선언 블록이 없다"
    - "custom.css의 단일 :root:not(.dark) 블록이 chart light mode 변수도 포함한다"
    - "640px 이하에서 --mp-glass-blur가 blur(8px) saturate(1.2)로 재정의된다"
    - "480px 이하에서 --mp-glass-blur가 blur(4px) saturate(1.1)로 재정의된다"
  artifacts:
    - path: "assets/css/custom.css"
      provides: "3티어 토큰 시스템 + 모바일 blur 미디어쿼리 + 통합된 :root:not(.dark)"
      contains: "@media (max-width: 640px)"
    - path: "assets/css/custom/chart-cards.css"
      provides: "변수 선언 없이 변수 소비만"
      min_lines: 1
    - path: "assets/css/custom/home-market-overview.css"
      provides: "변수 선언 없이 변수 소비만"
      min_lines: 1
  key_links:
    - from: "assets/css/custom/chart-cards.css"
      to: "assets/css/custom.css :root"
      via: "변수 선언 이전 (chart-cards.css :root 블록 제거)"
      pattern: "--mp-chart-card-bg"
    - from: "assets/css/custom/home-market-overview.css"
      to: "assets/css/custom.css :root"
      via: "변수 선언 이전 (home-market-overview.css :root 블록 제거)"
      pattern: "--mp-orb-color-primary"
    - from: "assets/css/custom.css @media max-width: 640px"
      to: ":root --mp-glass-blur"
      via: "CSS 변수 재정의"
      pattern: "max-width: 640px"
---

<objective>
3티어 CSS 토큰 시스템을 구축한다: chart-cards.css와 home-market-overview.css의 --mp-* 변수 선언을 custom.css 단일 소스로 이전하고, 컴포넌트 파일에서 :root 선언 블록을 제거하며, 모바일 blur 최적화 미디어쿼리를 추가한다.

Purpose: 모든 --mp-* 변수가 custom.css 한 곳에서만 선언되어야 변수 변경 시 한 파일만 수정하면 된다. 모바일에서 blur(14px)는 GPU 부하가 크므로 640px/480px 이하에서 자동 축소된다.
Output: custom.css (토큰 통합 + 모바일 미디어쿼리), chart-cards.css (:root 블록 제거), home-market-overview.css (:root 블록 제거)
</objective>

<execution_context>
@C:/Users/sc/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/1-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@assets/css/custom.css
@assets/css/custom/chart-cards.css
@assets/css/custom/home-market-overview.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: 컴포넌트 CSS 파일에서 :root 변수 선언 제거 (FOUN-04)</name>
  <files>
    assets/css/custom/chart-cards.css
    assets/css/custom/home-market-overview.css
  </files>
  <action>
    두 컴포넌트 파일에서 :root {} 변수 선언 블록을 제거한다.
    변수 소비 코드(var(--mp-...) 참조)는 절대 건드리지 않는다.

    **chart-cards.css 수정:**

    제거 대상 1 — 파일 상단 :root 블록 (1-7행):
    ```css
    :root {
      --mp-chart-card-bg: rgba(10, 10, 26, 0.85);
      --mp-chart-border: rgba(124, 58, 237, 0.25);
      --mp-chart-accent: #7c3aed;
      --mp-chart-cyan: #00f0ff;
      --mp-chart-text-muted: #64748b;
    }
    ```
    이 블록 전체를 삭제한다. 파일이 `.market-chart-card {` 선택자로 시작하게 된다.

    제거 대상 2 — 파일 중간 :root:not(.dark) 블록 (151-155행 근방):
    ```css
    :root:not(.dark) {
      --mp-chart-card-bg: rgba(255, 255, 255, 0.95);
      --mp-chart-border: rgba(124, 58, 237, 0.15);
      --mp-chart-text-muted: #94a3b8;
    }
    ```
    이 블록 전체를 삭제한다. 바로 다음에 오는 `:root:not(.dark) .market-chart-card { ... }` 규칙은 유지한다 (이것은 변수 선언이 아닌 컴포넌트 스타일 규칙이다).

    **home-market-overview.css 수정:**

    제거 대상 — 파일 중간 :root 블록 (9-12행):
    ```css
    :root {
      --mp-orb-color-primary: 124 58 237;
      --mp-orb-color-secondary: 0 240 255;
    }
    ```
    이 블록 전체를 삭제한다. `.mp-home-shell` 선택자 바로 뒤에 오는 이 블록만 제거하면 된다.
    파일 구조가 `.mp-home-shell { ... }` 다음에 `.mp-ambient-orb { ... }`로 이어지게 된다.
  </action>
  <verify>
    1. `grep -n "^:root" assets/css/custom/chart-cards.css` → 빈 결과 (no :root blocks)
    2. `grep -n "^:root" assets/css/custom/home-market-overview.css` → 빈 결과
    3. `grep -n "var(--mp-chart" assets/css/custom/chart-cards.css` → 변수 소비 코드가 여전히 존재함 (삭제 안 됨)
  </verify>
  <done>
    chart-cards.css와 home-market-overview.css에 :root {} 또는 :root:not(.dark) {} 변수 선언 블록이 없다.
    chart-cards.css에서 var(--mp-chart-...) 참조가 그대로 존재한다.
  </done>
</task>

<task type="auto">
  <name>Task 2: custom.css에 이전된 변수 통합 + 모바일 blur 미디어쿼리 추가 (FOUN-04, 05, 06, 07)</name>
  <files>assets/css/custom.css</files>
  <action>
    custom.css의 기존 :root 블록과 :root:not(.dark) 블록에 이전된 변수를 추가하고, 모바일 blur 미디어쿼리를 신규 추가한다.

    Plan 01 실행 후 custom.css 상태:
    - :root {} 블록 (39-82행 근방): 기존 변수들 존재
    - .dark {} 블록 (84-87행 근방): dark mode brand overrides
    - :root:not(.dark) {} 블록 (89-104행 근방): light mode 변수 단일 블록 (Plan 01에서 중복 제거 완료)

    **수정 A — :root 블록에 Tier 3 컴포넌트 변수 추가 (FOUN-04)**

    기존 :root {} 블록 내부 끝에 다음을 추가한다 (regime 변수 선언 다음, 블록 닫기 `}` 바로 전):
    ```css
      /* === Tier 3: Component Tokens (migrated from component files) === */
      /* chart-cards.css에서 이전 */
      --mp-chart-card-bg: rgba(10, 10, 26, 0.85);
      --mp-chart-border: rgba(124, 58, 237, 0.25);
      --mp-chart-accent: #7c3aed;
      --mp-chart-cyan: #00f0ff;
      --mp-chart-text-muted: #64748b;
      /* home-market-overview.css에서 이전 */
      --mp-orb-color-primary: 124 58 237;
      --mp-orb-color-secondary: 0 240 255;
    ```

    **수정 B — :root:not(.dark) 블록에 chart light mode 변수 추가 (FOUN-04, FOUN-06)**

    기존 :root:not(.dark) {} 블록 내부 끝에 다음을 추가한다:
    ```css
      /* chart-cards.css :root:not(.dark) 에서 이전 */
      --mp-chart-card-bg: rgba(255, 255, 255, 0.95);
      --mp-chart-border: rgba(124, 58, 237, 0.15);
      --mp-chart-text-muted: #94a3b8;
    ```

    **수정 C — 모바일 blur 미디어쿼리 추가 (FOUN-07)**

    :root:not(.dark) {} 블록 직후(또는 .dark {} 블록 직후)에 다음 두 미디어쿼리를 추가한다.
    CSS cascade 순서상 :root {} 블록 이후에 위치해야 올바르게 오버라이드된다:
    ```css
    /* === Mobile Blur Optimization (FOUN-07) === */
    @media (max-width: 640px) {
      :root {
        --mp-glass-blur: blur(8px) saturate(1.2);
      }
    }

    @media (max-width: 480px) {
      :root {
        --mp-glass-blur: blur(4px) saturate(1.1);
      }
    }
    ```

    중요 — CSS cascade 순서 유지:
    1. :root {} (primitive + dark defaults)
    2. .dark {}
    3. :root:not(.dark) {} (light mode overrides)
    4. @media (max-width: 640px) { :root {} } ← 여기 추가
    5. @media (max-width: 480px) { :root {} } ← 여기 추가
    6. 이후 컴포넌트 스타일들

    주의:
    - CSS `var()` 내부에서 함수 합성 불가: `blur(var(--mp-blur-px))` 형태는 작동하지 않는다. 반드시 `--mp-glass-blur: blur(8px) saturate(1.2)` 처럼 함수 전체를 변수값으로 지정한다.
    - 변수명 변경 금지: `--mp-glass-blur`, `--mp-chart-card-bg` 등 기존 이름 그대로 유지.
  </action>
  <verify>
    1. `grep -n "mp-chart-card-bg\|mp-orb-color-primary" assets/css/custom.css` → custom.css :root 블록 안에서 발견됨
    2. `grep -n "max-width: 640px\|max-width: 480px" assets/css/custom.css` → 두 미디어쿼리 모두 발견됨
    3. `grep -n "mp-chart-card-bg" assets/css/custom/chart-cards.css` → 변수 선언 없고 var() 소비만 존재
    4. Hugo 빌드 에러 없음: `hugo --gc --minify 2>&1 | grep -i "^Error"` → 빈 결과
  </verify>
  <done>
    custom.css :root 블록에 --mp-chart-card-bg, --mp-chart-border, --mp-chart-accent, --mp-chart-cyan, --mp-chart-text-muted, --mp-orb-color-primary, --mp-orb-color-secondary가 선언된다.
    custom.css :root:not(.dark) 블록에 --mp-chart-card-bg (light), --mp-chart-border (light), --mp-chart-text-muted (light)가 포함된다.
    custom.css에 max-width: 640px와 max-width: 480px :root 재정의 블록이 존재한다.
    Hugo 빌드가 에러 없이 완료된다.
  </done>
</task>

</tasks>

<verification>
전체 Phase 1 완료 검증:

1. `grep -c "^:root:not(.dark) {" assets/css/custom.css` → 1 (단일 블록)
2. `grep -n "^:root" assets/css/custom/chart-cards.css` → 빈 결과
3. `grep -n "^:root" assets/css/custom/home-market-overview.css` → 빈 결과
4. `grep -n "backdrop-filter: blur(8px)" assets/css/custom/toc-and-effects.css` → 빈 결과 (Plan 01 완료 확인)
5. `grep -n "TOCView" assets/css/custom/toc-and-effects.css` → prefers-reduced-motion 블록 내부에 위치
6. `grep -n "max-width: 640px\|max-width: 480px" assets/css/custom.css` → 2줄 발견
7. `hugo --gc --minify 2>&1 | grep -c "^Error"` → 0
</verification>

<success_criteria>
- --mp-* 변수 선언이 custom.css에만 존재한다 (chart-cards.css, home-market-overview.css의 :root 블록 없음)
- custom.css :root 블록에 --mp-chart-card-bg, --mp-orb-color-primary 등 컴포넌트 변수가 포함된다
- custom.css :root:not(.dark) 블록에 chart light mode 오버라이드가 포함된다
- 640px 이하 @media :root 블록이 --mp-glass-blur를 blur(8px) saturate(1.2)로 재정의한다
- 480px 이하 @media :root 블록이 --mp-glass-blur를 blur(4px) saturate(1.1)로 재정의한다
- Hugo 빌드가 에러 없이 완료된다
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
