# Codebase Structure

**Analysis Date:** 2026-02-19

## Directory Layout

```
dungan24.github.io/
├── .github/
│   └── workflows/
│       └── hugo.yml                    # GitHub Actions: Hugo build + publish
├── archetypes/
│   └── default.md                      # Hugo template for new posts
├── assets/
│   ├── css/
│   │   ├── custom.css                  # Main custom stylesheet loader
│   │   ├── custom/
│   │   │   ├── briefing-sections.css   # Section wrapping + zone styling
│   │   │   ├── calendar.css            # Calendar grid layout
│   │   │   ├── calendar-polish.css     # Calendar theme overrides
│   │   │   ├── chart-cards.css         # Chart container styling
│   │   │   ├── home-briefing-cards.css # Homepage card grid
│   │   │   ├── home-market-overview.css# Homepage ticker display
│   │   │   ├── layout-overrides.css    # Blowfish theme overrides
│   │   │   ├── post-content.css        # Post typography + spacing
│   │   │   ├── post-hero.css           # Hero section styling
│   │   │   ├── reading-progress.css    # Top reading progress bar
│   │   │   ├── skeleton.css            # Loading skeleton UI
│   │   │   ├── terminal-footer.css     # Footer terminal-style display
│   │   │   ├── theme-fixes.css         # Dark/light mode fixes
│   │   │   └── toc-and-effects.css     # TOC + scroll-reveal effects
│   │   └── schemes/
│   │       ├── cyberpunk.css           # Cyberpunk color scheme
│   │       └── fintech.css             # Fintech color scheme
│   └── img/
│       └── hero.svg                    # Homepage hero image
├── config/
│   └── _default/
│       ├── hugo.toml                   # Hugo core config (baseURL, theme, pagination)
│       ├── languages.ko.toml           # Korean language config
│       ├── markup.toml                 # Markdown rendering (goldmark, highlight)
│       ├── menus.ko.toml               # Navigation menu structure
│       └── params.toml                 # Hugo params (site-wide + market_pulse config)
├── content/
│   ├── _index.md                       # Homepage content
│   ├── about.md                        # About page
│   ├── api-documentation.md            # API docs page
│   ├── data-consent.md                 # Data policy page
│   ├── investment-strategy.md          # Strategy page
│   ├── market-calendar.md              # Calendar page
│   ├── security-protocol.md            # Security info page
│   ├── posts/
│   │   ├── hello-world.md              # Example post
│   │   ├── pre-market-2026-*.md        # Pre-market briefings (daily)
│   │   ├── mid-day-2026-*.md           # Mid-day briefings (occasional)
│   │   └── post-market-2026-*.md       # Post-market briefings (daily)
│   └── qa/
│       └── ticker-samples.md           # Ticker reference page
├── docs/                               # Documentation (not published)
│   └── ...
├── i18n/                               # i18n locale files (unused, ko-only)
│   └── ...
├── layouts/
│   ├── partials/
│   │   ├── extend-head-uncached.html   # Data bridge: inject config + load CSS
│   │   ├── extend-footer.html          # Load all JS modules in sequence
│   │   ├── footer.html                 # Footer template override
│   │   ├── comments.html               # Comments section (disabled)
│   │   └── home/
│   │       ├── custom.html             # Homepage custom layout
│   │       └── recent-briefings.html   # Recent briefings card grid
│   └── shortcodes/
│       ├── market-calendar.html        # Calendar section shortcode
│       ├── market-charts.html          # Charts container + loader shortcode
│       ├── news-grid.html              # News grid shortcode
│       ├── regime-panel.html           # Regime status shortcode
│       └── ticker-group.html           # Ticker group shortcode
├── static/
│   ├── data/
│   │   └── chart-data-2026-*.json      # Market chart data (generated by market-pulse)
│   └── js/
│       ├── mp-config.js                # Global config (defaults + merge)
│       ├── theme-transition.js         # Light/dark mode transition
│       ├── reading-progress.js         # Reading progress bar
│       ├── footer-clock.js             # Clock display in footer
│       ├── branding-patch.js           # Header branding tweaks
│       ├── home-market-overview.js     # Homepage ticker rendering
│       ├── market-charts-loader.js     # Chart data fetch + validation
│       ├── render-charts.js            # Echarts rendering
│       ├── market-pulse-calendar.js    # Calendar adapter (thin wrapper)
│       ├── market-pulse-enhancements.js# Main orchestrator (DOMContentLoaded)
│       ├── briefing/
│       │   ├── dom-utils.js            # DOM query + colorize utilities
│       │   ├── section-wrapping.js     # Wrap content by zone (FACT/OPINION)
│       │   ├── regime-hero.js          # Inject regime hero card
│       │   ├── collapsible.js          # Collapsible section toggle
│       │   ├── news-grid.js            # News section → grid cards
│       │   ├── ticker-cards.js         # Table → ticker card conversion
│       │   ├── toc-scrollspy.js        # TOC active link highlighting
│       │   └── calendar-loader.js      # Calendar section transform + KRX holidays
│       └── calendar/
│           ├── parser.js               # Schedule text → calendar event parser
│           ├── model.js                # Calendar model (month, events, filtering)
│           └── renderer.js             # Calendar → DOM rendering
├── .planning/
│   └── codebase/
│       ├── ARCHITECTURE.md             # This architecture document
│       └── STRUCTURE.md                # This structure document
├── public/                             # Hugo build output (git-ignored)
│   └── ...
├── .git/
├── .gitignore
├── .gitmodules                         # Blowfish theme as git submodule
├── CLAUDE.md                           # Project instructions (cross-repo SSOT)
├── AGENTS.md                           # AI agent guidelines
├── AI_CODING_RULES.md                  # Coding rules
├── LICENSE
├── PLAN.md                             # Detailed project roadmap
├── PROJECT_MAP.md                      # Quick project reference
├── README.md                           # Public project intro
├── package.json                        # npm scripts (serve.cmd wrapper)
└── serve.cmd                           # Windows batch: hugo server launcher
```

## Directory Purposes

**config/_default/:**
- Purpose: Hugo configuration (build-time)
- Contains: TOML files for Hugo settings, theme params, navigation, i18n
- Key files: `hugo.toml` (core), `params.toml` (market_pulse config)

**content/posts/:**
- Purpose: Briefing markdown content (source of truth)
- Contains: Daily pre-market/post-market briefs + occasional mid-day briefs
- Pattern: Filenames = `{slot}-{date}.md` (e.g., `pre-market-2026-02-19.md`)
- Generated: Yes (auto-generated by upstream `market-pulse` repo)
- Committed: Yes (downstream repo stores snapshots)

**content/ (root pages):**
- Purpose: Static pages (about, API docs, security, etc.)
- Contains: Long-form reference content
- Not auto-generated

**assets/css/:**
- Purpose: Styling (loaded via Hugo asset pipeline, fingerprinted)
- Contains: Custom overrides + modular CSS files (one concern per file)
- Committed: Yes

**assets/css/schemes/:**
- Purpose: Color theme overrides (selectable via params)
- Contains: `cyberpunk.css` (current), `fintech.css` (alternative)
- Usage: Blowfish theme `colorScheme = "cyberpunk"` selects file

**static/js/:**
- Purpose: Client-side transforms (loaded after HTML render)
- Contains: Modular JS using namespace pattern
- Committed: Yes (all JS is hand-written or from templates)
- Not minified: Used as-is in browser (no build step)

**static/js/briefing/:**
- Purpose: Briefing-specific DOM transforms
- Contains: News grid, calendar, ticker cards, collapsible, etc.
- Pattern: Each module is (function() { var ns = window.MPBriefing = ... })()

**static/js/calendar/:**
- Purpose: Calendar parsing + rendering (separated for complexity)
- Contains: Parser (text→events), Model (calendar state), Renderer (events→DOM)
- Pattern: Factory functions that export converter/model/render functions

**static/data/:**
- Purpose: Market chart JSON data (generated by market-pulse)
- Contains: `chart-data-YYYY-MM-DD.json` files
- Generated: Yes (upstream repo produces, downstream stores)
- Committed: Yes (snapshots stored in git)

**layouts/partials/:**
- Purpose: Hugo template fragments (included in base theme)
- Key files:
  - `extend-head-uncached.html`: Data bridge + CSS loading
  - `extend-footer.html`: JS module loading
  - `home/custom.html`: Homepage layout
  - `home/recent-briefings.html`: Homepage card grid

**layouts/shortcodes/:**
- Purpose: Semantic markup helpers for markdown
- Usage: `{{< shortcode-name param1="value" >}}...{{< /shortcode-name >}}`
- Examples: `{{< market-charts >}}`, `{{< market-calendar >}}`, `{{< news-grid >}}`

**docs/:**
- Purpose: Development/operational documentation
- Contains: Specification, agent guidelines, analysis
- Not published (git-committed reference docs)

## Key File Locations

**Entry Points:**
- `layouts/_default/single.html`: Post template (from Blowfish theme)
  - Includes `extend-head-uncached.html` + `extend-footer.html`
- `layouts/_default/home.html`: Homepage template (from theme, uses custom partial)
- `layouts/partials/home/custom.html`: Homepage layout (custom)

**Configuration:**
- `config/_default/hugo.toml`: Hugo core (baseURL, theme, pagination)
- `config/_default/params.toml`: All params including market_pulse section
- `layouts/partials/extend-head-uncached.html`: Hugo-JS bridge (injects `window.__MP_CONFIG`)

**Core Logic:**
- `static/js/mp-config.js`: Global config singleton (default + merge)
- `static/js/market-pulse-enhancements.js`: Orchestrator (reads config, dispatches transforms)
- `static/js/briefing/calendar-loader.js`: Calendar processor entry point

**Testing:**
- No automated tests (static site)
- Manual validation: `tools/architecture-lint.ps1`, `tools/agent-preflight.ps1`, `tools/calendar-smoke.ps1`
- Smoke tests in PowerShell (Windows-specific)

## Naming Conventions

**Files:**

- **Partials:** `layouts/partials/{path}/{filename}.html`
  - `extend-*.html` = content extension hook
  - `*.html` = semantic name matching responsibility
  - Examples: `extend-head-uncached.html`, `comments.html`, `home/recent-briefings.html`

- **Shortcodes:** `layouts/shortcodes/{name}.html`
  - Use hyphen-case: `market-charts`, `news-grid`, `ticker-group`
  - One concern per file

- **JS Modules:** `static/js/{path}/{name}.js`
  - Kebab-case filenames: `mp-config.js`, `market-pulse-enhancements.js`
  - Subdirectories by concern: `briefing/`, `calendar/`
  - No file extensions in require (not used; all loaded via script tags)

- **CSS:** `assets/css/custom/{name}.css`
  - Kebab-case: `briefing-sections.css`, `chart-cards.css`
  - One major concern per file

- **Content:** `content/{section}/{slug}.md`
  - Posts: `posts/{type}-{date}.md` where type ∈ {pre-market, mid-day, post-market}
  - Static pages: `{page-name}.md` in root
  - Date format: `YYYY-MM-DD`

- **Configuration:** `config/_default/{domain}.toml`
  - Domain: `hugo`, `languages.ko`, `markup`, `menus.ko`, `params`

**Directories:**

- `layouts/` = Hugo templates (Blowfish theme convention)
- `content/` = Hugo content (Blowfish convention)
- `config/` = Hugo config (Blowfish convention)
- `assets/` = Hugo assets (Blowfish convention, compiled to static)
- `static/` = Copied as-is to public (no processing)
- `archetypes/` = Hugo archetype templates
- `i18n/` = Hugo i18n locale files (unused)

## Where to Add New Code

**New Feature (Briefing Transform):**
- **Implementation:** `static/js/briefing/{feature-name}.js`
  - Follow namespace pattern: `var ns = window.MPBriefing = window.MPBriefing || {};`
  - Export a single function: `ns.{featureName} = function(content) { ... };`
  - Call from `market-pulse-enhancements.js` after checking `typeof ns.{featureName} === 'function'`
- **Load:** Add script tag to `layouts/partials/extend-footer.html`
  - Place in logical sequence (before dependents)
  - Example order: utilities → transformers → orchestrator

**New Style (CSS Concern):**
- **Implementation:** `assets/css/custom/{concern-name}.css`
  - Use BEM or atomic naming to avoid collisions
  - Class scope: `.mp-{feature-name}__element--modifier`
- **Load:** Add to `extend-head-uncached.html`
  - Hugo will minify + fingerprint automatically
  - Place in `{{ range $path := slice ... }}` array

**New Content (Briefing Post):**
- **Implementation:** `content/posts/{slot}-{date}.md`
  - Front matter required:
    ```yaml
    ---
    title: "..."
    date: 2026-02-19T00:00:00+09:00
    tags: ["tag1", "tag2"]
    chartData: "/data/chart-data-2026-02-19.json"  # if charts needed
    ---
    ```
  - Body: Use HTML comments for zones: `<!-- FACT_ZONE_START -->`, `<!-- OPINION_ZONE_END -->`
  - Tables auto-converted to ticker cards by `ticker-cards.js`

**New Calendar/Market Feature:**
- **Parser:** `static/js/calendar/parser.js`
  - Add pattern to `createParser()` factory function
  - Return normalized event objects with `{ date, time, title, importance }`
- **Model:** `static/js/calendar/model.js`
  - Add filter/sort logic if needed
  - Model manages state between parser and renderer
- **Renderer:** `static/js/calendar/renderer.js`
  - Add DOM generation for new event type
  - Use CSS classes from `assets/css/custom/calendar.css`

**New Shortcode:**
- **Implementation:** `layouts/shortcodes/{name}.html`
  - Hugo template (`.Inner` = content, `.Get` = params)
  - Use semantic HTML + data attributes
  - Emit data via `data-` attributes if JS processing needed
- **Example:**
  ```html
  <section class="briefing-section" data-mp-{feature}>
    {{ .Inner | markdownify }}
  </section>
  ```
- **Load:** Auto-available; reference as `{{< name >}}...{{< /name >}}` in markdown

**New Configuration:**
- **Implementation:** `config/_default/params.toml`
  - Add under `[market_pulse]` section for briefing-related config
  - Use TOML nested tables: `[market_pulse.subsection]`
  - Inject via `extend-head-uncached.html` to `window.__MP_CONFIG`
- **Access:** `var config = window.MP_CONFIG;` in JS modules

**New Static Page:**
- **Implementation:** `content/{page-name}.md`
  - Front matter: `title`, `date`, `draft: false`, `tags: []`
  - Body: Markdown (no special zones needed for static pages)
- **Navigation:** Add entry to `config/_default/menus.ko.toml`

**New Color Scheme:**
- **Implementation:** `assets/css/schemes/{scheme-name}.css`
  - Override Blowfish CSS variables for colors
  - Reference: `assets/css/schemes/cyberpunk.css` (current active)
- **Enable:** Change `config/_default/params.toml` → `colorScheme = "scheme-name"`

## Special Directories

**public/:**
- Purpose: Build output (Hugo generates)
- Generated: Yes (run `hugo` command)
- Committed: No (git-ignored, published to GitHub Pages)

**static/data/:**
- Purpose: Market chart data (static files served as-is)
- Generated: Yes (upstream `market-pulse` repo)
- Committed: Yes (snapshots stored in git)
- Lifecycle: Updated daily by upstream pipeline

**.planning/codebase/:**
- Purpose: AI agent reference (this document)
- Generated: Yes (by `gsd:map-codebase`)
- Committed: Yes (part of codebase documentation)

---

*Structure analysis: 2026-02-19*
