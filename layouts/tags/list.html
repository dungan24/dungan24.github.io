{{ define "main" }}
{{ .Store.Set "scope" "list" }}

{{ $pages := .Pages }}
{{ $totalCount := len $pages }}
{{ $tagName := .Title }}

{{/* ========== 히어로 ========== */}}
<section class="pl-hero">
  <div class="pl-hero__inner">
    <h1 class="pl-hero__title">#{{ $tagName }}</h1>
    <p class="pl-hero__subtitle">태그별 게시물 모아보기</p>
    <p class="pl-hero__count">총 <span>{{ $totalCount }}</span>개 게시물</p>
  </div>
</section>

{{/* ========== 카드 목록 (posts/list.html 카드 재활용) ========== */}}
<section class="pl-container">
  {{ $grouped := $pages.GroupByDate "2006-01-02" }}
  {{ range $grouped }}
    {{ $dateStr := .Key }}
    {{ $t := time $dateStr }}
    {{ $weekdays := slice "일" "월" "화" "수" "목" "금" "토" }}
    {{ $wdIdx := $t.Weekday }}
    {{ $wd := index $weekdays (int $wdIdx) }}
    {{ $label := printf "%s (%s)" ($t.Format "01.02") $wd }}

    <div class="pl-date-group" data-date="{{ $dateStr }}">
      <div class="pl-date-label">{{ $label }}</div>
      <div class="pl-date-cards">
        {{ range .Pages }}
          {{ $slot := .Params.slot | default "" }}
          {{ $slotClass := "other" }}
          {{ $slotLabel := "기타" }}
          {{ if eq $slot "pre-market" }}
            {{ $slotClass = "pre" }}
            {{ $slotLabel = "Pre-Market" }}
          {{ else if eq $slot "mid-day" }}
            {{ $slotClass = "mid" }}
            {{ $slotLabel = "Mid-Day" }}
          {{ else if eq $slot "post-market" }}
            {{ $slotClass = "post" }}
            {{ $slotLabel = "Post-Market" }}
          {{ end }}

          {{ $regime := .Params.regime | default "" }}
          {{ $summary := .Params.summary | default .Description | default "" }}

          <a href="{{ .RelPermalink }}" class="pl-card pl-card--{{ $slotClass }}" data-slot="{{ $slot }}" data-regime="{{ $regime }}">
            {{ if $slot }}
              <span class="pl-card__slot">{{ $slotLabel }}</span>
            {{ end }}
            <div class="pl-card__header">
              <h3 class="pl-card__title">{{ .Title }}</h3>
              {{ with .Params.generatedAt }}
                {{ $gt := time . }}
                <time class="pl-card__time">{{ $gt.Format "15:04" }} KST</time>
              {{ end }}
            </div>
            {{ with $summary }}
              <p class="pl-card__summary">{{ . }}</p>
            {{ end }}
            <div class="pl-card__footer">
              {{ with $regime }}
                <span class="pl-card__regime">{{ . }}</span>
              {{ end }}
            </div>
          </a>
        {{ end }}
      </div>
    </div>
  {{ end }}
</section>

{{/* ========== 페이지네이션 ========== */}}
{{ $paginator := .Paginator }}
{{ if gt $paginator.TotalPages 1 }}
<nav class="pl-pagination">
  {{ if $paginator.HasPrev }}
    <a href="{{ $paginator.Prev.URL }}">&laquo;</a>
  {{ end }}
  {{ range $paginator.Pagers }}
    {{ if eq . $paginator }}
      <span class="is-current">{{ .PageNumber }}</span>
    {{ else }}
      <a href="{{ .URL }}">{{ .PageNumber }}</a>
    {{ end }}
  {{ end }}
  {{ if $paginator.HasNext }}
    <a href="{{ $paginator.Next.URL }}">&raquo;</a>
  {{ end }}
</nav>
{{ end }}
{{ end }}
