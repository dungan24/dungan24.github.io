{{ define "main" }}
{{ .Store.Set "scope" "list" }}

{{ $allTags := .Data.Terms }}
{{ $totalCount := len $allTags }}

{{/* 브리핑 관련 태그 이름 (소문자) */}}
{{ $briefingNames := slice "pre-market" "mid-day" "post-market" "브리핑" }}

{{/* ========== 히어로 ========== */}}
<section class="tl-hero">
  <div class="tl-hero__inner">
    <h1 class="tl-hero__title">태그</h1>
    <p class="tl-hero__subtitle">브리핑과 용어를 주제별로 탐색</p>
    <p class="tl-hero__count">총 <span>{{ $totalCount }}</span>개 태그</p>
  </div>
</section>

<section class="tl-container">
  {{/* ========== 브리핑 태그 ========== */}}
  {{ $hasBriefing := false }}
  {{ range $allTags }}
    {{ if in $briefingNames (lower .Page.Title) }}{{ $hasBriefing = true }}{{ end }}
  {{ end }}

  {{ if $hasBriefing }}
  <h2 class="tl-section-title">브리핑 슬롯</h2>
  <div class="tl-grid">
    {{ range $allTags }}
      {{ if in $briefingNames (lower .Page.Title) }}
      <a href="{{ .Page.RelPermalink }}" class="tl-card">
        <div class="tl-card__header">
          <span class="tl-card__name">{{ .Page.Title }}</span>
          <span class="tl-card__count">{{ .Count }}</span>
        </div>
        <div class="tl-card__previews">
          {{ range first 3 .Pages }}
            <div class="tl-card__preview">{{ .Title }}</div>
          {{ end }}
          {{ if gt .Count 3 }}
            <span class="tl-card__more">+{{ sub .Count 3 }}개 더</span>
          {{ end }}
        </div>
      </a>
      {{ end }}
    {{ end }}
  </div>
  {{ end }}

  {{/* ========== 주제 태그 ========== */}}
  <h2 class="tl-section-title">주제</h2>
  <div class="tl-grid">
    {{ range $allTags }}
      {{ if not (in $briefingNames (lower .Page.Title)) }}
      <a href="{{ .Page.RelPermalink }}" class="tl-card">
        <div class="tl-card__header">
          <span class="tl-card__name">{{ .Page.Title }}</span>
          <span class="tl-card__count">{{ .Count }}</span>
        </div>
        <div class="tl-card__previews">
          {{ range first 3 .Pages }}
            <div class="tl-card__preview">{{ .Title }}</div>
          {{ end }}
          {{ if gt .Count 3 }}
            <span class="tl-card__more">+{{ sub .Count 3 }}개 더</span>
          {{ end }}
        </div>
      </a>
      {{ end }}
    {{ end }}
  </div>
</section>
{{ end }}
