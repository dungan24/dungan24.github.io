{{ $alg := .Site.Params.fingerprintAlgorithm | default "sha512" }}
{{ $mp := .Site.Params.market_pulse }}
{{ $external := index $mp "external" | default dict }}
{{ $fontsCssUrl := index $external "fonts_css_url" | default "https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" }}
{{ $echartsCdn := index $external "echarts_cdn" | default "https://cdn.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js" }}

<link rel="stylesheet" href="{{ $fontsCssUrl }}">
{{ $phosphorBold := index $external "phosphor_icons_bold" | default "https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/bold/style.css" }}
{{ $phosphorRegular := index $external "phosphor_icons_regular" | default "https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/regular/style.css" }}
<link rel="stylesheet" href="{{ $phosphorBold }}">
<link rel="stylesheet" href="{{ $phosphorRegular }}">

{{ range $path := slice "css/custom/briefing-sections.css" "css/custom/calendar.css" "css/custom/calendar-polish.css" "css/custom/calendar-standalone.css" "css/custom/toc-and-effects.css" "css/custom/layout-overrides.css" "css/custom/chart-cards.css" "css/custom/home-market-overview.css" "css/custom/terminal-footer.css" "css/custom/home-briefing-cards.css" "css/custom/post-content.css" "css/custom/theme-fixes.css" "css/custom/reading-progress.css" "css/custom/post-hero.css" "css/custom/skeleton.css" "css/custom/ambient-orbs.css" "css/custom/glossary.css" "css/custom/glossary-tooltip.css" "css/custom/investment-strategy.css" "css/custom/about.css" "css/custom/posts-list.css" "css/custom/tags-list.css" }}
  {{ with resources.Get $path }}
    {{ $css := . | resources.Minify | resources.Fingerprint $alg }}
    <link type="text/css" rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">
  {{ end }}
{{ end }}

{{/* Bloomberg Terminal Theme: conditional CSS + font loading */}}
{{ if eq .Site.Params.colorScheme "bloomberg" }}
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap">
  {{ with resources.Get "css/custom/bloomberg-overrides.css" }}
    {{ $css := . | resources.Minify | resources.Fingerprint $alg }}
    <link type="text/css" rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">
  {{ end }}
{{ end }}

<script>
  window.__MP_CONFIG = {{ .Site.Params.market_pulse | jsonify | safeJS }};
</script>

{{ if .Params.chartData }}
<script>
  window.__MP_PAGE = {{ dict
    "regime" (.Params.regime | default "")
    "regimeIcon" (.Params.regimeIcon | default "")
    "summary" (.Params.summary | default "")
    "chartData" .Params.chartData
  | jsonify | safeJS }};
</script>
<script src="{{ $echartsCdn }}"></script>
{{ end }}
{{/* calendar-polish.css must come after calendar.css */}}
