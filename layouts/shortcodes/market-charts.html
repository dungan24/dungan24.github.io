{{ if .Page.Params.chartData }}
<div class="w-full" id="market-charts-root">
  <div class="market-chart-card" id="charts-status-container" data-label="Loading">
    <div class="chart-loading-state" id="charts-loading-ui">
      <div class="chart-spinner"></div>
      <span>Loading market data...</span>
    </div>
  </div>

  <div class="hidden" id="charts-content">
    <div class="market-chart-card" data-label="Trend">
      <h3 class="chart-title-compact">ğŸ“ˆ ì£¼ìš” ì§€í‘œ ì¶”ì´</h3>
      <div class="chart-box" id="chart-timeseries" style="height:350px"></div>
    </div>

    <div class="mp-chart-grid-2col">
      <div class="market-chart-card" data-label="Correlation">
        <h3 class="chart-title-compact">ğŸ”— ìì‚° ê°„ ìƒê´€ê´€ê³„</h3>
        <div class="chart-box" id="chart-correlations" style="height:300px"></div>
      </div>

      <div class="market-chart-card" data-label="Regime">
        <h3 class="chart-title-compact">ğŸ¯ ì‹œì¥ êµ­ë©´ (Regime)</h3>
        <div class="chart-box" id="chart-regime" style="height:300px"></div>
      </div>
    </div>

    <div class="mp-chart-grid-2col">
      <div class="market-chart-card" data-label="Sectors">
        <h3 class="chart-title-compact">ğŸ“Š ì„¹í„° ìƒëŒ€ê°•ë„</h3>
        <div class="chart-box" id="chart-sectors" style="height:300px"></div>
      </div>

      <div class="market-chart-card" data-label="5-Day">
        <h3 class="chart-title-compact">ğŸ“‰ 5ì¼ ë³€ë™ ë¹„êµ</h3>
        <div class="chart-box" id="chart-5day" style="height:300px"></div>
      </div>
    </div>
  </div>
</div>

<script src="/js/render-charts.js"></script>
<script>
  (function() {
    const chartDataUrl = '{{ .Page.Params.chartData }}';
    if (!chartDataUrl) return;

    const statusContainer = document.getElementById('charts-status-container');
    const loadingUI = document.getElementById('charts-loading-ui');
    const content = document.getElementById('charts-content');

    fetch(chartDataUrl)
      .then(r => {
        if (!r.ok) throw new Error('DATA_UNAVAILABLE');
        return r.json();
      })
      .then(data => renderAllCharts(data))
      .then(() => {
        if (statusContainer) statusContainer.style.display = 'none';
        if (content) content.classList.remove('hidden');
      })
      .catch(err => {
        console.error('Chart data load failed:', err);
        if (loadingUI) {
          loadingUI.innerHTML = '<div style="text-align:center;color:#FF3366"><div style="font-weight:700;margin-bottom:0.5rem;font-family:Orbitron,sans-serif;letter-spacing:0.1em">[ CONNECTION_ERROR ]</div><div style="font-size:12px;opacity:0.9;font-family:JetBrains Mono,monospace;color:#64748B">FAILED TO SYNCHRONIZE MARKET DATA</div></div>';
        }
      });
  })();
</script>
{{ end }}
