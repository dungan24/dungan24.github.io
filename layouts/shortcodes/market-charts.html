{{ if .Page.Params.chartData }}
<div class="w-full" id="market-charts-root">
  <div class="market-chart-card" id="charts-status-container" data-label="SYSTEM // SYNC">
    <div class="chart-loading-state" id="charts-loading-ui">
      <div class="chart-spinner"></div>
      <span>CONNECTING TO TERMINAL...</span>
    </div>
  </div>

  <div class="hidden" id="charts-content">
    <div class="market-chart-card" data-label="CHART // INTRA-DAY TREND">
      <h3 class="chart-title-compact">ğŸ“ˆ ì£¼ìš” ì§€í‘œ ì¶”ì´</h3>
      <div class="chart-box" id="chart-timeseries"></div>
    </div>

    <div class="grid grid-cols-1 gap-5 md:grid-cols-2">
      <div class="market-chart-card" data-label="ANALYSIS // CORRELATION">
        <h3 class="chart-title-compact">ğŸ”— ìì‚° ê°„ ìƒê´€ê´€ê³„</h3>
        <div class="chart-box" id="chart-correlations" style="height:320px"></div>
      </div>

      <div class="market-chart-card" data-label="MARKET // REGIME SCORE">
        <h3 class="chart-title-compact">ğŸ¯ ì‹œì¥ êµ­ë©´ (Regime)</h3>
        <div class="chart-box" id="chart-regime" style="height:320px"></div>
      </div>
    </div>

    <div class="market-chart-card" data-label="SECTOR // RELATIVE STRENGTH">
      <h3 class="chart-title-compact">ğŸ“Š ì„¹í„° ìƒëŒ€ê°•ë„</h3>
      <div class="chart-box" id="chart-sectors"></div>
    </div>

    <div class="market-chart-card" data-label="PERFORMANCE // 5-DAY CHANGE">
      <h3 class="chart-title-compact">ğŸ“‰ 5ì¼ ë³€ë™ ë¹„êµ</h3>
      <div class="chart-box" id="chart-5day" style="height:320px"></div>
    </div>
  </div>
</div>

<script src="/js/render-charts.js"></script>
<script>
  (function() {
    const chartDataUrl = '{{ .Page.Params.chartData }}';
    if (!chartDataUrl) return;

    const statusContainer = document.getElementById('charts-status-container');
    const loadingUI = document.getElementById('charts-loading-ui');
    const content = document.getElementById('charts-content');

    fetch(chartDataUrl)
      .then(r => {
        if (!r.ok) throw new Error('DATA_UNAVAILABLE');
        return r.json();
      })
      .then(data => renderAllCharts(data))
      .then(() => {
        if (statusContainer) statusContainer.style.display = 'none';
        if (content) content.classList.remove('hidden');
      })
      .catch(err => {
        console.error('Chart data load failed:', err);
        if (loadingUI) {
          loadingUI.innerHTML = '<div style="text-align:center;color:#f87171"><div style="font-weight:700;margin-bottom:0.5rem">[ CONNECTION_ERROR ]</div><div style="font-size:12px;opacity:0.9">FAILED TO SYNCHRONIZE MARKET DATA</div></div>';
        }
      });
  })();
</script>
{{ end }}
