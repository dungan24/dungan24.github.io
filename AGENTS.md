# AGENTS.md

Agent operating guide for `market-pulse-blog`.
This file is for agentic coding tools working inside this repository.

## 1) Project Snapshot

- Name: `market-pulse-blog`
- Runtime: Hugo static site (Blowfish theme)
- Purpose: render and publish briefing content generated by `../market-pulse`
- Key rendering layer:
  - Loader: `layouts/partials/extend-footer.html`
  - Post behavior: `static/js/briefing/*.js` + `static/js/market-pulse-enhancements.js`
  - Calendar converter core: `static/js/calendar/{parser,model,renderer}.js`
  - Calendar converter entrypoint: `static/js/market-pulse-calendar.js`
  - Styles: `assets/css/custom.css` + `assets/css/custom/*.css`
- Data flow: `market-pulse` -> `market-pulse-blog` (content only)

Primary references:
- `CLAUDE.md`
- `config/_default/hugo.toml`
- `.github/workflows/hugo.yml`
- `../market-pulse/specs/render-contract.md`
- `../market-pulse/specs/smoke-checklist.md`
- `../market-pulse/.aidocs/blog-workflow.md` - cross-repo workflow
- `docs/agent-architecture-roadmap.md` - refactor roadmap

## 2) Source-of-Truth Commands

### Run local dev server

```bash
hugo server --port 1314 --bind 0.0.0.0 --navigateToChanged
```

### Windows helper script

```bash
serve.cmd
```

### Production build check

```bash
hugo --gc --minify
```

### Agent preflight audit

```bash
pwsh -File tools/agent-preflight.ps1
pwsh -File tools/agent-preflight.ps1 -RunBuild -FailOnFindings
pwsh -File tools/calendar-smoke.ps1 -BaseUrl http://localhost:1314
pwsh -File tools/architecture-lint.ps1 -FailOnFindings
```

## 3) Code and Rendering Conventions

- Do not edit generated briefing posts in `content/posts/` unless explicitly requested
- Treat `content/posts/pre-market-*.md` and `static/data/chart-data-*.json` as pipeline-managed outputs
- Keep markdown parsing rules backward-compatible with writer output
- Keep `layouts/partials/extend-footer.html` as a thin script loader only
- Implement post behavior changes in `static/js/briefing/*.js`
- Implement calendar parsing/rendering changes in `static/js/calendar/*.js`
- Keep `static/js/market-pulse-calendar.js` as an entrypoint/adapter only (no parser/model/renderer implementation)
- Keep visual updates in `assets/css/custom.css` and semantic split files under `assets/css/custom/`
- Prefer no inline `<script>/<style>` in `layouts/`; use external assets
- Preserve mobile behavior across 640px, 768px, 1024px breakpoints

## 4) Contribution Guardrails for Agents

- Read target files before editing
- Prefer minimal, surgical changes
- Do not reformat unrelated files
- Never change data semantics in this repo; only rendering/transformation behavior
- Run `pwsh -File tools/agent-audit.ps1` before and after large refactors
- Run `pwsh -File tools/architecture-lint.ps1 -FailOnFindings` before opening PR
- Use `.ignore` defaults for search; use `--no-ignore` only when intentionally scanning vendored/binary paths
- Treat `docs/screenshots/` as non-runtime archive; avoid using it as implementation source
- Keep runtime source files (`assets/`, `layouts/`, `static/js/`) below size thresholds where feasible
- Keep module granularity moderate:
  - prefer 1 entrypoint + feature modules
  - avoid splitting files below ~120 lines unless reused across 2+ features
  - if one feature change repeatedly touches 3+ modules, merge adjacent modules
  - do not split only for stylistic reasons; split only when ownership or change frequency justifies it
- If markdown parsing rules are changed, verify at least one recent pre-market post rendering end-to-end
- If parser behavior changes, update the render contract document in `market-pulse`

Validation checklist before finishing:
- Run `pwsh -File tools/agent-preflight.ps1 -RunBuild -FailOnFindings`
- Run `pwsh -File tools/calendar-smoke.ps1 -BaseUrl http://localhost:1314`
- Run local Hugo server and verify `/posts/pre-market-YYYY-MM-DD/`
- Confirm news cards (`.mp-news-card`) parse headline/meta/excerpt separately
- Confirm no duplicated translation/excerpt text in rendered cards

## 7) CI and PR Policy

- Architecture quality gate workflow: `.github/workflows/quality-gate.yml`
- PR checklist template: `.github/pull_request_template.md`
- CODEOWNERS enforced review set: `.github/CODEOWNERS`
- For architecture-sensitive changes, do not merge until the quality gate workflow is green

## 5) Repo-Specific Workflow Hints

- This repo does not generate facts; it only renders/publishes supplied content
- If rendering looks stale, first verify source markdown/json arrival times in `content/posts/` and `static/data/`
- If `market-pulse` pipeline path is wrong, set `BLOG_REPO_PATH` in `market-pulse` before debugging blog UI
- Treat contract changes as cross-repo changes; sync docs in both repositories in the same session

## 6) Maintenance

When changing operational behavior, update this file in the same PR:
- local run command/port
- Hugo build workflow
- markdown parsing rules in footer loader and loaded JS modules
- key style/UX constraints for `custom.css` and semantic split CSS files
- audit/preflight thresholds and inline-template policy
